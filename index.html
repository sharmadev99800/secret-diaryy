<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Secret Diary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 15px;
    }
    h2 {
      text-align: center;
    }
    .box {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      max-width: 500px;
      margin: auto;
      margin-bottom: 15px;
    }
    textarea {
      width: 100%;
      height: 120px;
      margin-top: 10px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 14px;
      resize: none;
    }
    button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    button:active {
      background: #555;
    }
    label {
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- QUIZ -->
  <div class="box" id="quiz-container">
    <h2>Answer to Unlock</h2>
  </div>

  <!-- DIARY -->
  <div class="box" id="diary-container" style="display:none;">
    <h2>Secret Diary</h2>
    <textarea id="note" placeholder="Write your secret here..."></textarea>
    <input type="file" id="voiceUpload" accept="audio/*">
    <button onclick="saveNote()">Save</button>
  </div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {

      // ----------------- Replace with your Supabase keys -----------------
      const SUPABASE_URL = "https://bceqcjlijqtbnzjksyex.supabase.co";
      const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJjZXFjamxpanF0Ym56amtzeWV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1OTg1OTYsImV4cCI6MjA4MjE3NDU5Nn0.n3GcwTUaPDnJYFdUuTfADXQ7JlxtBLROILTcoIsliTs";

      const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // ----------------- Quiz Questions -----------------
      const quizQuestions = [
        { question: "What is my favorite color?", options: ["Red","Blue","Green","Yellow"], answer: "Blue" },
        { question: "What is my favorite food?", options: ["Pizza","Burger","Pasta","Sushi"], answer: "Pizza" },
        { question: "Where was I born?", options: ["City A","City B","City C","City D"], answer: "City B" },
        { question: "My favorite animal?", options: ["Dog","Cat","Bird","Fish"], answer: "Dog" },
        { question: "My favorite hobby?", options: ["Reading","Gaming","Traveling","Drawing"], answer: "Gaming" }
      ];

      // ----------------- Show Quiz -----------------
      function showQuiz() {
        const container = document.getElementById("quiz-container");
        container.innerHTML = "";
        quizQuestions.forEach((q, index) => {
          container.innerHTML += `
            <p>${q.question}</p>
            ${q.options.map(opt => `
              <label>
                <input type="radio" name="q${index}" value="${opt}"> ${opt}
              </label><br>
            `).join("")}
          `;
        });
        container.innerHTML += `<button onclick="checkQuiz()">Submit Quiz</button>`;
      }

      // ----------------- Check Quiz Answers -----------------
      window.checkQuiz = function() {
        let correct = 0;
        quizQuestions.forEach((q, i) => {
          const selected = document.querySelector(`input[name=q${i}]:checked`);
          if (selected && selected.value === q.answer) correct++;
        });
        if (correct >= 3) { // Require 3 correct answers
          document.getElementById("quiz-container").style.display = "none";
          document.getElementById("diary-container").style.display = "block";
        } else {
          alert("Wrong answers. Try again!");
        }
      }

      // ----------------- Save Note & Voice -----------------
      window.saveNote = async function() {
        const note = document.getElementById("note").value;
        const voiceFile = document.getElementById("voiceUpload").files[0];

        let voiceUrl = null;

        if (voiceFile) {
          const { data, error } = await supabase.storage
            .from('voices')
            .upload(`voices/${Date.now()}-${voiceFile.name}`, voiceFile);

          if (error) {
            console.error(error);
            alert("Voice upload failed!");
            return;
          }
          voiceUrl = data.path;
        }

        const { data, error } = await supabase.from('Notes').insert([
          { text: note, voice: voiceUrl }
        ]);

        if (error) {
          console.error(error);
          alert("Saving note failed!");
        } else {
          alert("Note saved successfully!");
          document.getElementById("note").value = "";
          document.getElementById("voiceUpload").value = "";
        }
      }

      // ----------------- Initialize -----------------
      showQuiz();
    });
  </script>
</body>
</html>
